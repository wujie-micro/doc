(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{296:function(t,e,o){"use strict";o.r(e);var a=o(1),r=Object(a.a)({},(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[o("h2",{attrs:{id:"_1、请求资源报错"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#_1、请求资源报错"}},[t._v("#")]),t._v(" 1、请求资源报错")]),t._v(" "),o("p",[t._v("请求报错为："),o("code",[t._v("Access to fetch at *** from origin *** has been blocked by CORS policy: No 'Access-Control-Allow-Origin'")])]),t._v(" "),o("p",[o("strong",[t._v("原因：")]),t._v(" 子应用跨域或者请求子应用资源没有携带 cookie")]),t._v(" "),o("p",[o("strong",[t._v("解决方案：")])]),t._v(" "),o("ol",[o("li",[o("p",[t._v("如果是跨域导致的错误，参考 "),o("RouterLink",{attrs:{to:"/guide/start.html#前提"}},[t._v("前提")])],1)]),t._v(" "),o("li",[o("p",[t._v("如果是求资源没有携带 cookie（一般请求返回码是 302 跳转到登录页），需要通过自定义 "),o("RouterLink",{attrs:{to:"/api/startApp.html#fetch"}},[t._v("fetch")]),t._v(" 将"),o("code",[t._v("fetch")]),t._v("的"),o("code",[t._v("credentials")]),t._v("设置为"),o("code",[t._v("include")]),t._v("，这样"),o("code",[t._v("cookie")]),t._v("才会携带上去")],1)])]),t._v(" "),o("div",{staticClass:"custom-block warning"},[o("p",{staticClass:"custom-block-title"},[t._v("警告")]),t._v(" "),o("p",[t._v("当"),o("code",[t._v("credentials")]),t._v("设置为"),o("code",[t._v("include")]),t._v("时，服务端的"),o("code",[t._v("Access-Control-Allow-Origin")]),t._v("不能设置为"),o("code",[t._v("*")]),t._v("，原因"),o("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#credentialed_requests_and_wildcards",target:"_blank",rel:"noopener noreferrer"}},[t._v("详见"),o("OutboundLink")],1),t._v("，服务端可以这样设置：")]),t._v(" "),o("div",{staticClass:"language-javascript extra-class"},[o("pre",{pre:!0,attrs:{class:"language-javascript"}},[o("code",[t._v("ctx"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),o("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),o("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Origin"')]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ctx"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("origin"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),o("h2",{attrs:{id:"_2、第三方包已经引入-使用时报错"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#_2、第三方包已经引入-使用时报错"}},[t._v("#")]),t._v(" 2、第三方包已经引入，使用时报错")]),t._v(" "),o("p",[o("strong",[t._v("原因：")]),t._v(" 脚本本来在全局执行，此时第三方包定义的全局变量（比如"),o("code",[t._v("var xxx")]),t._v("）会直接挂载到"),o("code",[t._v("window")]),t._v("上。但是"),o("code",[t._v("wujie")]),t._v("将所有的脚本都包裹在一个闭包内运行方便劫持，所以这些全局变量会留在闭包内，无法挂载到"),o("code",[t._v("window")]),t._v("上，子应用的异步脚本会在另一个闭包内运行，所以拿不到这些全局变量。")]),t._v(" "),o("p",[o("strong",[t._v("解决方案：")])]),t._v(" "),o("p",[t._v("1、方式一：需要将第三方包定义的全局变量显式的挂载到"),o("code",[t._v("window")]),t._v("上（比如"),o("code",[t._v("window.xxx")]),t._v("），或者修改第三方包"),o("code",[t._v("webpack")]),t._v("的"),o("a",{attrs:{href:"https://webpack.docschina.org/configuration/output/#outputlibrarytarget",target:"_blank",rel:"noopener noreferrer"}},[o("code",[t._v("output.libraryTarget")]),o("OutboundLink")],1)]),t._v(" "),o("p",[t._v("2、方式二：如果用户不想修改代码可以通过"),o("RouterLink",{attrs:{to:"/guide/plugin.html#js-loader"}},[t._v("插件")]),t._v("的形式动态的将全局定义的地方 "),o("code",[t._v("xxx=")]),t._v("修改成"),o("code",[t._v("window.xxx=")])],1),t._v(" "),o("h2",{attrs:{id:"_3、子应用的字体没有生效"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#_3、子应用的字体没有生效"}},[t._v("#")]),t._v(" 3、子应用的字体没有生效")]),t._v(" "),o("p",[o("strong",[t._v("原因：")]),t._v(" "),o("code",[t._v("@font-face")]),t._v("不会在"),o("code",[t._v("shadow")]),t._v("内部加载，"),o("a",{attrs:{href:"https://github.com/mdn/interactive-examples/issues/887",target:"_blank",rel:"noopener noreferrer"}},[t._v("详见"),o("OutboundLink")],1)]),t._v(" "),o("p",[o("strong",[t._v("解决方案：")]),t._v(" 将子应用需要到的"),o("code",[t._v("@font-face")]),t._v("在主应用进行加载")]),t._v(" "),o("h2",{attrs:{id:"_4、冒泡系列组件-比如下拉框-弹出位置不正确"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#_4、冒泡系列组件-比如下拉框-弹出位置不正确"}},[t._v("#")]),t._v(" 4、冒泡系列组件（比如下拉框）弹出位置不正确")]),t._v(" "),o("p",[o("strong",[t._v("原因：")]),t._v(" 比如"),o("code",[t._v("element-plus")]),t._v("采用了"),o("code",[t._v("popper.js")]),t._v("2.0 版本，这个版本计算位置会递归元素一直计算到"),o("code",[t._v("window.visualViewport")]),t._v("，但是子应用的"),o("code",[t._v("dom")]),t._v("挂载在"),o("code",[t._v("shadowRoot")]),t._v("上，并没有"),o("code",[t._v("window.visualViewport")]),t._v("这部分滚动量，导致偏移计算失败")]),t._v(" "),o("p",[o("strong",[t._v("解决方案：")]),t._v(" 将子应用将"),o("code",[t._v("body")]),t._v("设置为"),o("code",[t._v("position: relative")]),t._v("即可")]),t._v(" "),o("h2",{attrs:{id:"_5、子应用处理异步处理事件时-e-target-变成了-wujie-app"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#_5、子应用处理异步处理事件时-e-target-变成了-wujie-app"}},[t._v("#")]),t._v(" 5、子应用处理异步处理事件时，e.target 变成了 wujie-app")]),t._v(" "),o("p",[o("strong",[t._v("原因：")]),t._v(" 这个问题是浏览器原生的处理，"),o("a",{attrs:{href:"https://stackoverflow.com/questions/63607966/event-target-changed-in-settimeout-in-shadow-dom",target:"_blank",rel:"noopener noreferrer"}},[t._v("详见"),o("OutboundLink")],1)]),t._v(" "),o("p",[o("strong",[t._v("解决方案：")]),t._v(" 在异步处理时，获取 e.target 的方式需要修改成：\n"),o("code",[t._v("(e.target.shadowRoot && e.composed) ? (e.composedPath()[0] || e.target) : e.target")])])])}),[],!1,null,null,null);e.default=r.exports}}]);