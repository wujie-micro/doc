(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{296:function(t,e,a){"use strict";a.r(e);var r=a(1),s=Object(r.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"_1、请求资源报错"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、请求资源报错"}},[t._v("#")]),t._v(" 1、请求资源报错")]),t._v(" "),e("p",[t._v("请求报错为："),e("code",[t._v("Access to fetch at *** from origin *** has been blocked by CORS policy: No 'Access-Control-Allow-Origin'")])]),t._v(" "),e("p",[e("strong",[t._v("原因：")]),t._v(" 子应用跨域或者请求子应用资源没有携带 cookie")]),t._v(" "),e("p",[e("strong",[t._v("解决方案：")])]),t._v(" "),e("ol",[e("li",[e("p",[t._v("如果是跨域导致的错误，参考 "),e("RouterLink",{attrs:{to:"/guide/start.html#前提"}},[t._v("前提")])],1)]),t._v(" "),e("li",[e("p",[t._v("如果是求资源没有携带 cookie（一般请求返回码是 302 跳转到登录页），需要通过自定义 "),e("RouterLink",{attrs:{to:"/api/startApp.html#fetch"}},[t._v("fetch")]),t._v(" 将"),e("code",[t._v("fetch")]),t._v("的"),e("code",[t._v("credentials")]),t._v("设置为"),e("code",[t._v("include")]),t._v("，这样"),e("code",[t._v("cookie")]),t._v("才会携带上去")],1)])]),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("警告")]),t._v(" "),e("p",[t._v("当"),e("code",[t._v("credentials")]),t._v("设置为"),e("code",[t._v("include")]),t._v("时，服务端的"),e("code",[t._v("Access-Control-Allow-Origin")]),t._v("不能设置为"),e("code",[t._v("*")]),t._v("，原因"),e("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#credentialed_requests_and_wildcards",target:"_blank",rel:"noopener noreferrer"}},[t._v("详见"),e("OutboundLink")],1),t._v("，服务端可以这样设置：")]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[t._v("ctx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Origin"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ctx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("origin"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),e("h2",{attrs:{id:"_2、第三方包已经引入-使用时报错"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、第三方包已经引入-使用时报错"}},[t._v("#")]),t._v(" 2、第三方包已经引入，使用时报错")]),t._v(" "),e("p",[e("strong",[t._v("原因：")]),t._v(" 脚本本来在全局执行，此时第三方包定义的全局变量（比如"),e("code",[t._v("var xxx")]),t._v("）会直接挂载到"),e("code",[t._v("window")]),t._v("上。但是"),e("code",[t._v("wujie")]),t._v("将所有的脚本都包裹在一个闭包内运行方便劫持修改"),e("code",[t._v("location")]),t._v("，所以这些全局变量会留在闭包内，无法挂载到"),e("code",[t._v("window")]),t._v("上，子应用的异步脚本会在另一个闭包内运行，所以拿不到这些全局变量。")]),t._v(" "),e("p",[e("strong",[t._v("解决方案：")])]),t._v(" "),e("p",[t._v("1、方式一：需要将第三方包定义的全局变量显式的挂载到"),e("code",[t._v("window")]),t._v("上（比如"),e("code",[t._v("window.xxx")]),t._v("），或者修改第三方包"),e("code",[t._v("webpack")]),t._v("的"),e("a",{attrs:{href:"https://webpack.docschina.org/configuration/output/#outputlibrarytarget",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("output.libraryTarget")]),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("2、方式二：如果用户不想修改代码可以通过"),e("RouterLink",{attrs:{to:"/guide/plugin.html#js-loader"}},[t._v("插件")]),t._v("的形式在运行时将全局定义的代码 "),e("code",[t._v("xxx=")]),t._v("替换成"),e("code",[t._v("window.xxx=")])],1),t._v(" "),e("h2",{attrs:{id:"_3、子应用的字体没有生效"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、子应用的字体没有生效"}},[t._v("#")]),t._v(" 3、子应用的字体没有生效")]),t._v(" "),e("p",[e("strong",[t._v("原因：")]),t._v(" "),e("code",[t._v("@font-face")]),t._v("不会在"),e("code",[t._v("shadow")]),t._v("内部加载，"),e("a",{attrs:{href:"https://github.com/mdn/interactive-examples/issues/887",target:"_blank",rel:"noopener noreferrer"}},[t._v("详见"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("strong",[t._v("解决方案：")]),t._v(" 将子应用需要到的"),e("code",[t._v("@font-face")]),t._v("在主应用进行加载")]),t._v(" "),e("h2",{attrs:{id:"_4、冒泡系列组件-比如下拉框-弹出位置不正确"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4、冒泡系列组件-比如下拉框-弹出位置不正确"}},[t._v("#")]),t._v(" 4、冒泡系列组件（比如下拉框）弹出位置不正确")]),t._v(" "),e("p",[e("strong",[t._v("原因：")]),t._v(" 比如"),e("code",[t._v("element-plus")]),t._v("采用了"),e("code",[t._v("popper.js")]),t._v("2.0 版本，这个版本计算位置会递归元素一直计算到"),e("code",[t._v("window.visualViewport")]),t._v("，但是子应用的"),e("code",[t._v("dom")]),t._v("挂载在"),e("code",[t._v("shadowRoot")]),t._v("上，并没有"),e("code",[t._v("window.visualViewport")]),t._v("这部分滚动量，导致偏移计算失败")]),t._v(" "),e("p",[e("strong",[t._v("解决方案：")]),t._v(" 将子应用将"),e("code",[t._v("body")]),t._v("设置为"),e("code",[t._v("position: relative")]),t._v("即可")]),t._v(" "),e("h2",{attrs:{id:"_5、子应用处理异步处理事件时-e-target-变成了-wujie-app"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5、子应用处理异步处理事件时-e-target-变成了-wujie-app"}},[t._v("#")]),t._v(" 5、子应用处理异步处理事件时，e.target 变成了 wujie-app")]),t._v(" "),e("p",[e("strong",[t._v("原因：")]),t._v(" 这个问题是浏览器原生的处理，"),e("a",{attrs:{href:"https://stackoverflow.com/questions/63607966/event-target-changed-in-settimeout-in-shadow-dom",target:"_blank",rel:"noopener noreferrer"}},[t._v("详见"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("strong",[t._v("解决方案：")]),t._v(" 在异步处理时，获取 e.target 的方式需要修改成：\n"),e("code",[t._v("(e.target.shadowRoot && e.composed) ? (e.composedPath()[0] || e.target) : e.target")])]),t._v(" "),e("h2",{attrs:{id:"_6、css-样式内部的相对地址相对的是主应用的域名"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6、css-样式内部的相对地址相对的是主应用的域名"}},[t._v("#")]),t._v(" 6、css 样式内部的相对地址相对的是主应用的域名")]),t._v(" "),e("p",[e("strong",[t._v("原因：")]),t._v(" 由于框架没有处理子应用样式内部的相对地址，而子应用样式是挂载在主应用容器中，导致相对地址错误")]),t._v(" "),e("p",[e("strong",[t._v("解决方案：")]),t._v(" 使用插件中的"),e("RouterLink",{attrs:{to:"/guide/plugin.html#css-loader"}},[t._v("css-loader")]),t._v("在运行时将相对地址代码替换成绝对地址。")],1),t._v(" "),e("h2",{attrs:{id:"_7、子应用使用-module-federation-引用远程模块报错"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7、子应用使用-module-federation-引用远程模块报错"}},[t._v("#")]),t._v(" 7、子应用使用 module federation 引用远程模块报错")]),t._v(" "),e("p",[e("strong",[t._v("原因：")]),t._v(" 原因"),e("a",{attrs:{href:"#_2%E3%80%81%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8C%85%E5%B7%B2%E7%BB%8F%E5%BC%95%E5%85%A5-%E4%BD%BF%E7%94%A8%E6%97%B6%E6%8A%A5%E9%94%99"}},[t._v("同 3")]),t._v("，都是由于闭包执行脚本导致脚本内的全局变量在其他脚本中无法读取")]),t._v(" "),e("p",[e("strong",[t._v("解决方案：")]),t._v(" 在"),e("code",[t._v("ModuleFederationPlugin")]),t._v("插件中设置"),e("code",[t._v("library")]),t._v("的"),e("code",[t._v("type")]),t._v("为"),e("code",[t._v("window")])]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[t._v("  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("library")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'window'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'保持和name一致'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);e.default=s.exports}}]);